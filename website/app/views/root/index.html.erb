
<% if @questions.present? %>

  <%= form_tag(root_path) do %>
    <div class="row">
      <div class="col-sm-4">
        Variable 1:
        <%= select_tag 'row', options_for_select(@questions.map{|x| ["#{x.code} - #{x.text}", x.code]}, params[:row]), :class => "selectpicker", :'data-live-search' => "true", :'data-size' => "7" %>
      </div>
      <div class="col-sm-4">
        Variable 2:
        <%= select_tag 'col', options_for_select(@questions.map{|x| ["#{x.code} - #{x.text}", x.code]}, params[:col].present? ? params[:col] : @questions[1].code), :class => "selectpicker", 
          :'data-live-search' => "true", :'data-size' => "7" %>
      </div>
      <div class="col-sm-4">
      <%= submit_tag 'Get Data', :class => 'btn btn-default' %>
      </div>
    </div>

    <hr />

    <% if @data.present? %>
      <div id="chart"></div>

      <hr />

      <table id="datatable" class="table table-striped table-hover">
        <thead>
          <tr>
            <th class="var1-col"></th>
            <th colspan="<%= (@data[:column_answers].length + 1) %>"><%= @data[:column_question].titlecase %></th>
          </tr>
          <tr>
            <th class="var1-col"><%= @data[:row_question].titlecase %></th>
            <% @data[:column_answers].each do |answer| %>
              <th><%= answer[1] %></th>
            <% end %>
          </tr>
        </thead>
        <tbody>
          <% (0..@data[:row_answers].length-1).each do |row_index| %>
            <tr>
              <td class="var1-col"><%= @data[:row_answers][row_index][1] %></td>
              <% @data[:percents][row_index].each do |percent| %>
                <td><%= number_to_percentage(percent) %></td>
              <% end %>
            </tr>
          <% end %>
        </tbody>
      </table>

      <% if @data[:map].present? %>

        <hr />

        <span>Filter Map By:</span>
        <div id="map_filter" class="btn-group">
          <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
          <span id="default_id"><%= @data[:map_filters][0][1] %></span> <span class="caret"></span>
          </button>
          <ul class="dropdown-menu" role="menu">
            <% @data[:map_filters].each do |filter| %>
              <li class="map_filter"><a href="#" data-id="<%= filter[0] %>"><%= filter[1] %></a></li>
            <% end %>
          </ul>
        </div>  

        <div id="map"></div>

      <% end %>
      

      <hr />

      <div class="row">
        <div class="col-sm-6">
          <p>
            <strong>Question:</strong>
            <%= @data[:row_question].titlecase %>
          </p>
          <p>
            <strong>Possible Answers:</strong>
          </p>
          <ul>
            <% @data[:row_answers].each do |answer| %>
              <li>
                <%= answer[1] %>
              </li>
            <% end %>
          </ul> 
        </div>
        <div class="col-sm-6">
          <p>
            <strong>Question:</strong>
            <%= @data[:column_question].titlecase %>
          </p>
          <p>
            <strong>Possible Answers:</strong>
          </p>
          <ul>
            <% @data[:column_answers].each do |answer| %>
              <li>
                <%= answer[1] %>
              </li>
            <% end %>
          </ul> 
        </div>
      </div>


    <% end %>


  <% end %>


<% else %>

  <p>
  Questions are not on file yet - have you run rake db:seed yet?
  </p>

<% end %>
